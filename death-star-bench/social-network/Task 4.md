# How to Run
Following steps is for `docker compose` deployment:
- run `docker build -t deathstarbench/social-network-microservices:local .`
- run `docker compose up`

# Test Coverage
This project provides Python scripts to test all of business logic related services, but not include frontend, caching services, and data storage services.

The coverage files generated by `gcov` are in [here](./coverage/)

If you want to generate the coverage, using following steps:
- clone my instrumented repo, `git clone https://github.com/CornDavid5/DeathStarBench`
- run `docker build -t deathstarbench/social-network-microservices:local .`
- run `docker compose up`
- go to test folder, `cd test`
- (optional) enable Python virtual environment
- install dependencies, `pip install -r requirements.txt`
- run `./run-test.bash` twice
- terminate docker containers, then restart docker containers
- you have to do the following command for each service, change the service name for different services
- ssh into the docker container, `docker exec -it <container-id> bash`
- `cd /social-network-microservices/build/src/<service-name>/CMakeFiles/<service-name>.dir`
- `gcov -o . -b /social-network-microservices/src/<service-name>/<service-name>.cpp | grep -A 5 <service-name>`
- `mkdir report && lcov --capture --directory . --output-file report/report.info`
- `genhtml report/report.info --output-directory report`
- `cp -r report/ /social-network-microservices/coverage/<service-name>/`