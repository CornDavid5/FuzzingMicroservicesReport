<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CreatorFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TeaStore Image Provider</a> &gt; <a href="index.source.html" class="el_package">tools.descartes.teastore.image.setup</a> &gt; <span class="el_source">CreatorFactory.java</span></div><h1>CreatorFactory.java</h1><pre class="source lang-java linenums">package tools.descartes.teastore.image.setup;

import java.awt.image.BufferedImage;
import java.nio.file.Path;
import java.util.List;
import java.util.Map;
import java.util.concurrent.atomic.AtomicLong;
import java.util.stream.Collectors;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import tools.descartes.teastore.entities.Category;
import tools.descartes.teastore.entities.ImageSize;
import tools.descartes.teastore.entities.ImageSizePreset;
import tools.descartes.teastore.image.ImageDB;

/**
 * Helper class creating image generation runnables for image provider setup.
 * @author Norbert Schmitt
 */
public class CreatorFactory {

<span class="nc" id="L24">  private int shapesPerImage = 0;</span>
<span class="nc" id="L25">  private ImageSize imgSize = ImageSizePreset.STD_IMAGE_SIZE;</span>
<span class="nc" id="L26">  private Path workingDir = SetupController.SETUP.getWorkingDir();</span>
  private Map&lt;Category, BufferedImage&gt; categoryImages;
  private List&lt;Long&gt; products;
  private List&lt;Category&gt; categories;
  private ImageDB imgDB;
  private AtomicLong nrOfImagesGenerated;

<span class="nc" id="L33">  private final Logger log = LoggerFactory.getLogger(CreatorFactory.class);</span>

  /**
   * Standard constructor defining all necessary information to create image generation runnables.
   * @param shapesPerImage Number of shapes per generated image.
   * @param imgDB Image database to add image to.
   * @param imgSize Size of the images to generate.
   * @param workingDir Directory to store images.
   * @param products Product IDs for which images will be generated.
   * @param categoryImages Category images that are added after random shapes for the image have been generated.
   * @param nrOfImagesGenerated Current number of images that have been generated by all runnables.
   */
  public CreatorFactory(int shapesPerImage, ImageDB imgDB, ImageSize imgSize, Path workingDir,
      Map&lt;Category, List&lt;Long&gt;&gt; products, Map&lt;Category, BufferedImage&gt; categoryImages,
<span class="nc" id="L47">      AtomicLong nrOfImagesGenerated) {</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">    if (imgDB == null) {</span>
<span class="nc" id="L49">      log.error(&quot;Supplied image database is null.&quot;);</span>
<span class="nc" id="L50">      throw new NullPointerException(&quot;Supplied image database is null.&quot;);</span>
    }
<span class="nc bnc" id="L52" title="All 2 branches missed.">    if (products == null) {</span>
<span class="nc" id="L53">      log.error(&quot;Supplied product map is null.&quot;);</span>
<span class="nc" id="L54">      throw new NullPointerException(&quot;Supplied product map is null.&quot;);</span>
    }
<span class="nc bnc" id="L56" title="All 2 branches missed.">    if (nrOfImagesGenerated == null) {</span>
<span class="nc" id="L57">      log.error(&quot;Supplied counter for images generated is null.&quot;);</span>
<span class="nc" id="L58">      throw new NullPointerException(&quot;Supplied counter for images generated is null.&quot;);</span>
    }

<span class="nc bnc" id="L61" title="All 2 branches missed.">    if (workingDir == null) {</span>
<span class="nc" id="L62">      log.info(&quot;Supplied working directory is null. Set to value {}.&quot;,</span>
<span class="nc" id="L63">          SetupController.SETUP.getWorkingDir());</span>
    } else {
<span class="nc" id="L65">      this.workingDir = workingDir;</span>
    }
<span class="nc bnc" id="L67" title="All 2 branches missed.">    if (categoryImages == null) {</span>
<span class="nc" id="L68">      log.info(&quot;Supplied category images are null. Defaulting to not add category images.&quot;);</span>
    } else {
<span class="nc" id="L70">      this.categoryImages = categoryImages;</span>
    }
<span class="nc bnc" id="L72" title="All 2 branches missed.">    if (imgSize == null) {</span>
<span class="nc" id="L73">      log.info(&quot;Supplied image size is null. Defaulting to standard size of {}.&quot;,</span>
          ImageSizePreset.STD_IMAGE_SIZE);
    } else {
<span class="nc" id="L76">      this.imgSize = imgSize;</span>
    }
<span class="nc bnc" id="L78" title="All 2 branches missed.">    if (shapesPerImage &lt; 0) {</span>
<span class="nc" id="L79">      log.info(&quot;Number of shapes per image cannot be below 0, was {}. Set to 0.&quot;, shapesPerImage);</span>
    } else {
<span class="nc" id="L81">      this.shapesPerImage = shapesPerImage;</span>
    }
<span class="nc" id="L83">    this.products = products.entrySet().stream().flatMap(e -&gt; e.getValue().stream())</span>
<span class="nc" id="L84">        .collect(Collectors.toList());</span>
<span class="nc" id="L85">    this.categories = products.entrySet().stream()</span>
<span class="nc" id="L86">        .flatMap(e -&gt; e.getValue().stream().map(x -&gt; e.getKey())).collect(Collectors.toList());</span>
<span class="nc" id="L87">    this.imgDB = imgDB;</span>
<span class="nc" id="L88">    this.nrOfImagesGenerated = nrOfImagesGenerated;</span>
<span class="nc" id="L89">  }</span>

  /**
   * Create the image generation runnable.
   * @return Image generation runnable.
   */
  public Runnable newRunnable() {
<span class="nc" id="L96">    return new CreatorRunner(imgDB, imgSize, products.remove(0), shapesPerImage,</span>
<span class="nc" id="L97">        categoryImages.getOrDefault(categories.remove(0), null), workingDir, nrOfImagesGenerated);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>